<div class="modal-container-paiement">
  <div class="modal-header-paiement">
    <h4 class="modal-title-paiement">
      <i class="fas fa-money-bill-wave me-2"></i>
      Paiement Lease
    </h4>
    <button type="button" class="btn-close-paiement" (click)="close()">
      <i class="fas fa-times"></i>
    </button>
  </div>

  <form class="modal-content-paiement" [formGroup]="paiementForm">
    @if (submitError()) {
      <div class="submit-error-paiement">
        <i class="fas fa-exclamation-triangle me-2"></i>
        {{ submitError() }}
      </div>
    }

    <!-- Section Contrat -->
    <div class="form-section-paiement">
      <h6 class="section-label-paiement">Contrat</h6>

      <div class="form-field-paiement">
        <label class="field-label-paiement">
          Contrat <span class="required-mark-paiement">*</span>
        </label>
        <select class="field-select-paiement"
                formControlName="contrat_id"
                [disabled]="isLoadingLeases()"
                [class.input-error-paiement]="contratIdCtrl.touched && contratIdCtrl.invalid">
          <option [ngValue]="null" disabled>— Sélectionner un contrat —</option>
          @for (c of contratsEncours(); track c.id) {
            <option [ngValue]="c.id">{{ c.chauffeur || ('Contrat #' + c.id) }}</option>
          }
        </select>
        @if (contratIdCtrl.touched && contratIdCtrl.invalid) {
          <div class="field-error-paiement">Veuillez sélectionner un contrat.</div>
        }
      </div>
    </div>

    <!-- Section Montants -->
    <div class="form-section-paiement">
      <h6 class="section-label-paiement">Montants</h6>

      <div class="form-grid-2-paiement">
        <div class="form-field-paiement">
          <label class="field-label-paiement">
            Montant Moto <span class="required-mark-paiement">*</span>
          </label>
          <div class="input-currency-paiement">
            <input type="number"
                   formControlName="montant_moto"
                   class="field-input-paiement"
                   placeholder="0"
                   [class.input-error-paiement]="montantMotoCtrl.touched && montantMotoCtrl.invalid">
            <span class="currency-suffix-paiement">FCFA</span>
          </div>
          @if (montantMotoCtrl.touched && montantMotoCtrl.invalid) {
            <div class="field-error-paiement">Montant moto requis et > 0.</div>
          }
        </div>

        <div class="form-field-paiement">
          <label class="field-label-paiement">
            Montant Batterie <span class="required-mark-paiement">*</span>
          </label>
          <div class="input-currency-paiement">
            <input type="number"
                   formControlName="montant_batt"
                   class="field-input-paiement"
                   placeholder="0"
                   [class.input-error-paiement]="montantBatterieCtrl.touched && montantBatterieCtrl.invalid">
            <span class="currency-suffix-paiement">FCFA</span>
          </div>
          @if (montantBatterieCtrl.touched && montantBatterieCtrl.invalid) {
            <div class="field-error-paiement">Montant batterie requis et >= 0.</div>
          }
        </div>
      </div>
    </div>

    <!-- Section Paiement -->
    <div class="form-section-paiement">
      <h6 class="section-label-paiement">Informations de paiement</h6>

      <div class="form-grid-1-paiement">
        <div class="form-field-paiement">
          <label class="field-label-paiement">
            Méthode de paiement <span class="required-mark-paiement">*</span>
          </label>
          <select class="field-select-paiement"
                  formControlName="methode_paiement"
                  [class.input-error-paiement]="methodeCtrl.touched && methodeCtrl.invalid">
            <option value="">— Sélectionner —</option>
            <option value="espece">Espèces</option>
            <option value="mobile_money">Mobile Money</option>
            <option value="orange_money">Orange Money</option>
          </select>
          @if (methodeCtrl.touched && methodeCtrl.invalid) {
            <div class="field-error-paiement">Méthode de paiement obligatoire.</div>
          }
        </div>

        <div class="form-field-paiement">
          <label class="field-label-paiement">Référence transaction</label>
          <input type="text"
                 formControlName="reference_transaction"
                 class="field-input-paiement"
                 placeholder="Référence optionnelle">
        </div>
      </div>
    </div>

    <!-- Section Dates -->
    <div class="form-section-paiement">
      <h6 class="section-label-paiement">Dates</h6>

      <div class="form-grid-2-paiement">
        <div class="form-field-paiement">
          <label class="field-label-paiement">
            Date concernée <span class="required-mark-paiement">*</span>
          </label>
          <input type="date"
                 formControlName="date_concernee"
                 class="field-input-paiement"
                 [class.input-error-paiement]="dateConcerneeCtrl.touched && dateConcerneeCtrl.invalid">
          @if (dateConcerneeCtrl.touched && dateConcerneeCtrl.invalid) {
            <div class="field-error-paiement">Date concernée obligatoire.</div>
          }
        </div>

        <div class="form-field-paiement">
          <label class="field-label-paiement">
            Date limite <span class="required-mark-paiement">*</span>
          </label>
          <input type="date"
                 formControlName="date_limite"
                 class="field-input-paiement"
                 [class.input-error-paiement]="dateLimiteCtrl.touched && dateLimiteCtrl.invalid">
          @if (dateLimiteCtrl.touched && dateLimiteCtrl.invalid) {
            <div class="field-error-paiement">Date limite obligatoire.</div>
          }
        </div>
      </div>
    </div>
  </form>

  <div class="modal-footer-paiement">
    <button type="button" class="btn-cancel-paiement" (click)="close()" [disabled]="isSubmitting()">
      <i class="fas fa-times me-1"></i>
      Annuler
    </button>
    <button type="button"
            class="btn-save-paiement"
            (click)="submit()"
            [disabled]="paiementForm.invalid || isSubmitting()">
      @if (isSubmitting()) {
        <span class="spinner-border spinner-border-sm me-1"></span>
        Enregistrement...
      } @else {
        <i class="fas fa-save me-1"></i>
        Enregistrer
      }
    </button>
  </div>
</div>
