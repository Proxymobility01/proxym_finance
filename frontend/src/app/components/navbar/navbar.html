<!-- Navbar principale -->
<nav class="navbar navbar-expand-lg custom-navbar">
  <div class="container-fluid">

    <!-- Logo -->
    <a class="navbar-brand " href="#">
        <img  src="logo.png" alt="logo proxym">
    </a>

    <!-- Navigation principale -->
    <div class="navbar-nav-container">
      <ul class="navbar-nav me-auto">

        <!-- Tableau de bord -->
        <li class="nav-item">
          <a class="nav-link" href="#" (click)="navigateToTableauBord()">
            Tableau de bord
          </a>
        </li>

        <!-- Contrats Dropdown -->
        <li class="nav-item dropdown" [class.show]="isContratsDropdownOpen">
          <a class="nav-link dropdown-toggle"
             href="#"
             role="button"
             (click)="toggleContratsDropdown()">
            Contrats
          </a>
          <ul class="dropdown-menu" [class.show]="isContratsDropdownOpen">
            <li><a class="dropdown-item" href="#" (click)="navigateToContratsChauf()">Contrats Chauffeurs</a></li>
            <li><a class="dropdown-item" href="#" (click)="navigateToContratsPartenaires()">Contrats Partenaires</a></li>
            <li><a class="dropdown-item" href="#" (click)="navigateToContratBatteries()">Contrat Batteries</a></li>
            <li><hr class="dropdown-divider"></li>
            <li><a class="dropdown-item" href="#" (click)="navigateToChauffeurs()">Chauffeurs</a></li>
            <li><a class="dropdown-item" href="#" (click)="navigateToGarants()">Garants</a></li>
            <li><a class="dropdown-item" href="#" (click)="navigateToPartenaires()">Partenaires</a></li>
            <li><a class="dropdown-item" href="#" (click)="navigateToConges()">Congés</a></li>
          </ul>
        </li>

        <!-- Paiements Dropdown -->
        <li class="nav-item dropdown" [class.show]="isPaiementsDropdownOpen">
          <a class="nav-link dropdown-toggle active-link"
             href="#"
             role="button"
             (click)="togglePaiementsDropdown()">
            Paiements
          </a>
          <ul class="dropdown-menu" [class.show]="isPaiementsDropdownOpen">
            <li><a class="dropdown-item" href="#" (click)="navigateToPaiementsContrats()">Paiements Contrats</a></li>
            <li><a class="dropdown-item" href="#" (click)="navigateToHistoriquePaiements()">Historique Paiements</a></li>
            <li><a class="dropdown-item" href="#" (click)="navigateToPenalites()">Pénalités</a></li>
            <li><a class="dropdown-item" href="#" (click)="navigateToSwap()">Swap</a></li>
            <li><a class="dropdown-item" href="#" (click)="navigateToRapports()">Rapports</a></li>
          </ul>
        </li>

        <!-- Stations Dropdown -->
        <li class="nav-item dropdown" [class.show]="isStationsDropdownOpen">
          <a class="nav-link dropdown-toggle"
             href="#"
             role="button"
             (click)="toggleStationsDropdown()">
            Stations
          </a>
          <ul class="dropdown-menu" [class.show]="isStationsDropdownOpen">
            <li><a class="dropdown-item" href="#" (click)="navigateToListeStations()">Liste des stations</a></li>
            <li><a class="dropdown-item" href="#" (click)="navigateToGestionCharges()">Gestion des charges</a></li>
            <li><a class="dropdown-item" href="#" (click)="navigateToRentabiliteStations()">Rentabilité de Stations</a></li>
          </ul>
        </li>

        <!-- Investisseurs -->
        <li class="nav-item">
          <a class="nav-link" href="#" (click)="navigateToInvestisseurs()">
            Investisseurs
          </a>
        </li>

      </ul>

      <!-- Actions à droite -->
      <div class="navbar-actions">

        <!-- Barre de recherche -->
        <div class="search-container" [class.search-expanded]="isSearchVisible">
          <button class="btn-search" (click)="toggleSearch()">
            <i class="fas fa-search"></i>
          </button>
          <input
            type="text"
            class="form-control search-input"
            placeholder="Rechercher..."
            [class.d-none]="!isSearchVisible"
            (input)="onSearch($event)"
            (blur)="isSearchVisible = false">
        </div>

        <!-- Notifications -->
        <div class="dropdown notification-dropdown">
          <button class="btn-notification"
                  type="button"
                  data-bs-toggle="dropdown"
                  aria-expanded="false">
            <i class="fas fa-bell"></i>
            @if (notificationCount > 0) {
              <span class="notification-badge">
              {{ notificationCount > 9 ? '9+' : notificationCount }}
            </span>
            }

          </button>
          <ul class="dropdown-menu dropdown-menu-end notification-menu">
            <li class="dropdown-header">
              <strong>Notifications ({{ notificationCount }})</strong>
            </li>
            <li><hr class="dropdown-divider"></li>
            @for (notification of notifications; track notifications){
              <li  class="notification-item">
                <div class="notification-content">
                  <div class="notification-message">{{ notification.message }}</div>
                  <div class="notification-time">{{ notification.time }}</div>
                  <button class="btn-close-notification" (click)="markNotificationAsRead(notification.id)">
                    <i class="fas fa-times"></i>
                  </button>
                </div>
              </li>
            }

            @if (notificationCount === 0) {
              <li class="text-center text-muted p-3">
                Aucune notification
              </li>
            }

          </ul>
        </div>

        <!-- Profil utilisateur -->
        <div class="dropdown profile-dropdown" [class.show]="isProfileDropdownOpen">
          <button class="btn-profile"
                  type="button"
                  (click)="toggleProfileDropdown()">
            <div class="profile-circle">
              <i class="fas fa-user"></i>
            </div>
          </button>
          <ul class="dropdown-menu dropdown-menu-end" [class.show]="isProfileDropdownOpen">
            <li><a class="dropdown-item" href="#" (click)="navigateToProfile()">
              <i class="fas fa-user me-2"></i>Mon profil
            </a></li>
            <li><a class="dropdown-item" href="#" (click)="navigateToParametres()">
              <i class="fas fa-cog me-2"></i>Paramètres
            </a></li>
            <li><hr class="dropdown-divider"></li>
            <li><a class="dropdown-item text-danger" href="#" (click)="logout()">
              <i class="fas fa-sign-out-alt me-2"></i>Déconnexion
            </a></li>
          </ul>
        </div>

        <!-- Bouton thème (optionnel) -->
        <button class="btn-theme">
          <i class="fas fa-adjust"></i>
        </button>

      </div>
    </div>
  </div>
</nav>

<!-- Backdrop pour fermer les dropdowns -->
@if (isContratsDropdownOpen || isPaiementsDropdownOpen || isStationsDropdownOpen || isProfileDropdownOpen) {
  <div class="dropdown-backdrop"
       (click)="closeAllDropdowns()">
  </div>
}

